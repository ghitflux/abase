{% extends 'base.html' %}

{% block title %}Importações{% endblock %}

{% block content %}
<main class="min-h-screen" style="background: var(--bg); color: var(--text);">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <div style="padding: 0.5rem; background: rgba(122, 19, 64, 0.1); border-radius: 0.5rem;">
          <svg style="width: 1.5rem; height: 1.5rem; color: var(--accent);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
        </div>
        <div>
          <h1 style="font-size: 1.5rem; font-weight: 700; color: var(--heading);">Importações de Mensalidades</h1>
          <p style="font-size: 0.875rem; color: var(--muted);">Gerencie e monitore suas importações de dados</p>
        </div>
      </div>
      <a href="{% url 'importador:importar' %}"
         class="ds-btn ds-btn--accent" style="padding: 0.5rem 1rem; font-weight: 500;">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Nova Importação
      </a>
    </div>
    
    <!-- Filters Card -->
    <div class="ds-card" style="margin-bottom: 1.5rem;">
      <div class="p-6">
        <form method="get" class="grid grid-cols-1 gap-4 sm:grid-cols-3">
          <div>
            <label for="status" class="ds-label">Status</label>
            <select name="status" id="status" class="ds-select">
              <option value="">Todos</option>
              {% for value, label in status_choices %}
                <option value="{{ value }}" {% if value == current_status %}selected{% endif %}>{{ label }}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="competencia" class="ds-label">Competência</label>
            <input type="text" name="competencia" id="competencia" value="{{ current_competencia|default:'' }}"
                   placeholder="YYYY-MM" class="ds-input">
          </div>
          <div class="flex items-end">
            <!-- Botão removido conforme solicitado -->
          </div>
        </form>
      </div>
    </div>
    <!-- Data Table -->
    <div class="ds-card" style="overflow: hidden;">
      <div class="overflow-x-auto">
        <table class="table table--dark" style="width: 100%;">
          <thead>
            <tr>
              <th scope="col">Arquivo</th>
              <th scope="col">Competência</th>
              <th scope="col">Processamento</th>
              <th scope="col">Upload</th>
              <th scope="col">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for importacao in page_obj %}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-8 w-8">
                    {% if importacao.tipo_arquivo == 'CSV' %}
                      <div class="chip chip--agente" style="width: 2rem; height: 2rem; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                        <span style="font-size: 0.75rem; font-weight: 600;">CSV</span>
                      </div>
                    {% else %}
                      <div style="width: 2rem; height: 2rem; border-radius: 50%; background: rgba(96, 165, 250, 0.1); display: flex; align-items: center; justify-content: center;">
                        <span style="font-size: 0.75rem; font-weight: 600; color: var(--info);">TXT</span>
                      </div>
                    {% endif %}
                  </div>
                  <div class="ml-4">
                    <div style="font-size: 0.875rem; font-weight: 500; color: var(--text);">{{ importacao.nome_arquivo }}</div>
                    <div style="font-size: 0.875rem; color: var(--muted);">{{ importacao.usuario.get_full_name|default:importacao.usuario.username }}</div>
                  </div>
                </div>
              </td>
              <td style="font-weight: 500;">{{ importacao.competencia }}</td>
              <td>
                {% if importacao.total_linhas > 0 %}
                  {{ importacao.linhas_processadas }}/{{ importacao.total_linhas }}
                  {% if importacao.linhas_com_erro > 0 %}
                    <span style="color: var(--danger);">({{ importacao.linhas_com_erro }} erros)</span>
                  {% endif %}
                {% else %}
                  -
                {% endif %}
              </td>
              <td style="color: var(--muted);">{{ importacao.data_upload|date:'d/m/Y H:i' }}</td>
              <td style="display: flex; gap: 0.5rem;">
                <a href="{% url 'importador:detalhe' importacao.id %}"
                   style="color: #3b82f6; font-weight: 500; text-decoration: none;">Ver detalhes</a>
                {% comment %}
                {% if importacao.status == 'ERRO' %}
                  <span style="color: var(--muted); font-size: 0.875rem;">Reprocessamento não disponível</span>
                {% endif %}
                {% endcomment %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5" style="padding: 3rem 1.5rem; text-align: center;">
                <div class="flex flex-col items-center">
                  <svg style="width: 3rem; height: 3rem; color: var(--muted); margin-bottom: 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                  </svg>
                  <p style="font-size: 0.875rem; color: var(--muted);">Nenhuma importação encontrada</p>
                  <p style="font-size: 0.75rem; color: var(--muted); margin-top: 0.25rem;">Faça sua primeira importação clicando no botão "Nova Importação"</p>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
        
        {% if page_obj.has_other_pages %}
        <div class="ds-card" style="padding: 0.75rem 1rem; border-top: 1px solid var(--border);">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <p style="font-size: 0.875rem; color: var(--muted);">
                        Mostrando {{ page_obj.start_index }} a {{ page_obj.end_index }} de {{ page_obj.paginator.count }} registros
                    </p>
                </div>
                <div class="flex">
                    {% if page_obj.has_previous %}
                        <a href="?page=1" class="ds-btn ds-btn--ghost" style="padding: 0.5rem 0.75rem; border-radius: 0.375rem 0 0 0.375rem;">Primeira</a>
                        <a href="?page={{ page_obj.previous_page_number }}" class="ds-btn ds-btn--ghost" style="padding: 0.5rem 0.75rem; border-radius: 0;">Anterior</a>
                    {% endif %}
                    
                    <span class="ds-btn ds-btn--accent" style="padding: 0.5rem 1rem;">
                        {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
                    </span>
                    
                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="ds-btn ds-btn--ghost" style="padding: 0.5rem 0.75rem; border-radius: 0;">Próxima</a>
                        <a href="?page={{ page_obj.paginator.num_pages }}" class="ds-btn ds-btn--ghost" style="padding: 0.5rem 0.75rem; border-radius: 0 0.375rem 0.375rem 0;">Última</a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}