<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste das M√°scaras Monet√°rias - ABASE</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-group { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-group h3 { margin-top: 0; color: #333; }
        input { padding: 10px; margin: 5px; width: 200px; border: 1px solid #ddd; border-radius: 4px; }
        .result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        button { padding: 10px 20px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ Teste das M√°scaras Monet√°rias - ABASE</h1>
    <p>Este arquivo testa se nossa corre√ß√£o das m√°scaras monet√°rias est√° funcionando corretamente.</p>

    <div class="test-group">
        <h3>üìä Teste Manual - Digite valores aqui</h3>
        <p><strong>Cen√°rios para testar:</strong></p>
        <ul>
            <li>Digite "400" ‚Üí Deve mostrar "R$ 400,00"</li>
            <li>Digite "400,50" ‚Üí Deve mostrar "R$ 400,50"</li>
            <li>Cole "R$ 1.234,56" ‚Üí Deve manter "R$ 1.234,56"</li>
        </ul>

        <label>Mensalidade Associativa: <input type="text" data-money="brl" id="mensalidade" placeholder="Digite 400"></label><br>
        <label>Valor Bruto Total: <input type="text" data-money="brl" id="bruto" placeholder="Digite 5000"></label><br>
        <label>Valor L√≠quido: <input type="text" data-money="brl" id="liquido" placeholder="Digite 3500"></label><br>

        <div class="result" id="manual-result">
            <strong>Resultados aparecer√£o aqui...</strong>
        </div>
    </div>

    <div class="test-group">
        <h3>üîç Teste Autom√°tico - Casos de Teste</h3>
        <button onclick="runTests()">Executar Testes</button>
        <div id="test-results"></div>
    </div>

    <div class="test-group">
        <h3>üéØ Simula√ß√£o do Formul√°rio de Cadastro</h3>
        <form id="test-form" onsubmit="simulateSubmit(event)">
            <label>Contribui√ß√£o Associativa: <input name="mensalidade_associativa" data-money="brl" value="400"></label><br>
            <label>Valor Bruto: <input name="valor_bruto_total" data-money="brl" value="5000"></label><br>
            <label>Valor L√≠quido: <input name="valor_liquido" data-money="brl" value="3500"></label><br>
            <button type="submit">Simular Envio para Backend</button>
        </form>
        <div id="submit-result"></div>
    </div>

    <!-- Carregamos nosso script -->
    <script src="static/js/money-mask.js"></script>

    <script>
        // Teste autom√°tico
        function runTests() {
            const results = document.getElementById('test-results');
            results.innerHTML = '<h4>Executando testes...</h4>';

            const tests = [
                { input: '400', expected: 400, description: 'N√∫mero simples' },
                { input: '400,50', expected: 400.50, description: 'Com decimais brasileiros' },
                { input: 'R$ 1.234,56', expected: 1234.56, description: 'Formato completo brasileiro' },
                { input: '1234.56', expected: 1234.56, description: 'Formato americano' },
                { input: '1.234', expected: 1234, description: 'Separador de milhar' },
                { input: '', expected: 0, description: 'Campo vazio' },
                { input: 'R$ 10.000,00', expected: 10000, description: 'Valor alto com separadores' }
            ];

            let html = '';
            let passedTests = 0;

            tests.forEach((test, index) => {
                try {
                    const result = window.ABASE.MoneyMask.parse(test.input);
                    const passed = Math.abs(result - test.expected) < 0.01;

                    if (passed) passedTests++;

                    html += `<div class="${passed ? 'success' : 'error'}">
                        <strong>Teste ${index + 1}:</strong> ${test.description}<br>
                        <strong>Input:</strong> "${test.input}"<br>
                        <strong>Esperado:</strong> ${test.expected}<br>
                        <strong>Resultado:</strong> ${result}<br>
                        <strong>Status:</strong> ${passed ? '‚úÖ PASSOU' : '‚ùå FALHOU'}
                    </div>`;
                } catch (error) {
                    html += `<div class="error">
                        <strong>Teste ${index + 1}:</strong> ${test.description}<br>
                        <strong>ERRO:</strong> ${error.message}
                    </div>`;
                }
            });

            html += `<div class="result">
                <strong>Resumo:</strong> ${passedTests}/${tests.length} testes passaram
            </div>`;

            results.innerHTML = html;
        }

        // Simula√ß√£o de envio
        function simulateSubmit(event) {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            let results = '<h4>Valores que seriam enviados para o backend:</h4>';

            for (let [name, value] of formData.entries()) {
                const parsed = window.ABASE.MoneyMask.parse(value);
                const backend = window.ABASE.MoneyMask.formatBackend(value);

                results += `<div>
                    <strong>${name}:</strong><br>
                    Display: ${value}<br>
                    Parsed: ${parsed}<br>
                    Backend: ${backend}
                </div>`;
            }

            document.getElementById('submit-result').innerHTML = results;
        }

        // Eventos para teste manual
        document.addEventListener('DOMContentLoaded', function() {
            const manualFields = ['mensalidade', 'bruto', 'liquido'];

            manualFields.forEach(id => {
                const field = document.getElementById(id);
                field.addEventListener('money-changed', function(e) {
                    updateManualResult();
                });
                field.addEventListener('blur', function(e) {
                    updateManualResult();
                });
            });
        });

        function updateManualResult() {
            const mensalidade = window.ABASE.MoneyMask.parse(document.getElementById('mensalidade').value);
            const bruto = window.ABASE.MoneyMask.parse(document.getElementById('bruto').value);
            const liquido = window.ABASE.MoneyMask.parse(document.getElementById('liquido').value);

            const trinta = (bruto * 0.30);
            const total = (mensalidade * 3);
            const doacao = (total * 0.30);
            const disponivel = (total * 0.70);

            const format = window.ABASE.MoneyMask.formatBRL;

            document.getElementById('manual-result').innerHTML = `
                <strong>C√°lculos Autom√°ticos:</strong><br>
                30% do Bruto: ${format(trinta)}<br>
                Total 3 parcelas: ${format(total)}<br>
                Doa√ß√£o (30%): ${format(doacao)}<br>
                Dispon√≠vel (70%): ${format(disponivel)}<br>
                <br>
                <em>Se "mensalidade = 400", dispon√≠vel deve ser R$ 840,00 (n√£o R$ 84.000,00!)</em>
            `;
        }
    </script>
</body>
</html>